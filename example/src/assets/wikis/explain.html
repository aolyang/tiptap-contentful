<h1 style="margin: 5px 0; font-size: 1.625em; font-weight: bolder; margin-top: 0.5em"><b>About Tiptap WYSIWYG Editor All I Know</b></h1><table style="min-width: 422px"><colgroup><col style="width: 397px"><col style="min-width: 25px"></colgroup><tbody><tr><td style="border: 1px solid #70707099" colspan="1" rowspan="1" colwidth="397"><img style="
            display: block;
            margin: 0 auto;
            max-width: 100%;
            max-height: 1000px;
            height: auto;
        " src="./doc-imgs/tiptap-logo.png"></td><td style="border: 1px solid #70707099" colspan="1" rowspan="1"><img style="
            display: block;
            margin: 0 auto;
            max-width: 100%;
            max-height: 1000px;
            height: auto;
        " src="./doc-imgs/svelte-logo.png"></td></tr></tbody></table><p>This is a practive project for exploring <code class="inline-code">Svelte</code> and <code class="inline-code">Tiptap</code> to create a WYSIWYG rich text editor. So , this project is <b>in prototype phase</b>.ðŸ¤£</p><p>This project's final goal is to be able to be a <code class="inline-code">TML5 Copy/Paste Friendly</code> &amp; <code class="inline-code">Email Friendly</code> &amp; <code class="inline-code">Markdown Friendly</code> feature rich WYSIWYG rich text editor ðŸš€ðŸš€ðŸš€.</p><table style="min-width: 343px"><colgroup><col style="width: 318px"><col style="min-width: 25px"></colgroup><tbody><tr><td style="border: 1px solid #70707099" colspan="1" rowspan="1" colwidth="318"><ul style="
            /*
             * It's a hack here, for some editor (eg: wechat editor) 
             * didn't support 0 value padding
             * so, you can paste taskList with style now
             */
            padding-left: 1px;
            margin-left: -1px;
        " data-type="taskList"><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="true" data-type="taskItem"><label><input type="checkbox" checked="checked"><span></span></label><div><p>fontStyle &amp; Alignment</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="true" data-type="taskItem"><label><input type="checkbox" checked="checked"><span></span></label><div><p>Marks</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="true" data-type="taskItem"><label><input type="checkbox" checked="checked"><span></span></label><div><p>CodeBlock (Shiki)</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="true" data-type="taskItem"><label><input type="checkbox" checked="checked"><span></span></label><div><p>Table</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="true" data-type="taskItem"><label><input type="checkbox" checked="checked"><span></span></label><div><p>Emojis &amp; Image</p></div></li></ul></td><td style="border: 1px solid #70707099" colspan="1" rowspan="1"><ul style="
            /*
             * It's a hack here, for some editor (eg: wechat editor) 
             * didn't support 0 value padding
             * so, you can paste taskList with style now
             */
            padding-left: 1px;
            margin-left: -1px;
        " data-type="taskList"><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="false" data-type="taskItem"><label><input type="checkbox"><span></span></label><div><p>CodeBlock language &amp; theme toggle</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="false" data-type="taskItem"><label><input type="checkbox"><span></span></label><div><p>Better Tooltip (include keymap, next)</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="false" data-type="taskItem"><label><input type="checkbox"><span></span></label><div><p>Table of contents</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="false" data-type="taskItem"><label><input type="checkbox"><span></span></label><div><p>Menu &amp; Quick command (select, slash)</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="false" data-type="taskItem"><label><input type="checkbox"><span></span></label><div><p>Dragbar (in plan, soon)</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="false" data-type="taskItem"><label><input type="checkbox"><span></span></label><div><p>Resize Box (base extension, in plan, soon)</p></div></li><li style="
                display: flex;
                gap: 0.625em;
            " data-checked="false" data-type="taskItem"><label><input type="checkbox"><span></span></label><div><p>Paper Mode (support <b>docx</b> and <b>PDF export</b>)</p></div></li></ul></td></tr></tbody></table><h2 style="margin: 5px 0; font-size: 1.250em; font-weight: bold; margin-top: 0.5em"><b>0x01 Why Svelte?</b></h2><p><code class="inline-code">Svelte</code> is a less runtime UI framework. Fewer components can get fewer runtime code.</p><p>I have built some vanilla JavaScript extensions for <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://www.sphinx-doc.org/en/master/#get-started"><u>Sphinx â€” Sphinx documentation</u></a>. For example Sphinx SVG contoller for <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://github.com/mermaid-js/mermaid"><u>mermaid-js/mermaid </u></a>(like github markdown mermaid controller)</p><img style="
            display: block;
            margin: 0 auto;
            max-width: 100%;
            max-height: 1000px;
            height: auto;
        " src="./doc-imgs/mermaid-extension.png"><img style="
            display: block;
            margin: 0 auto;
            max-width: 100%;
            max-height: 1000px;
            height: auto;
        " src="./doc-imgs/mermaid-example.png"><p>I got a small output, <b>less than 5KB</b> that excited me (17.33KB total including 12KB pan zoom library and others).</p><p>Using <code class="inline-code">Svelte</code> to build a vanilla JavaScript plugin, can provide you with good DX and small output. So I can use <code class="inline-code">Svelte</code> to build <code class="inline-code">Tiptap NodeView</code> components with pleasure.</p><p>You can see <code class="inline-code">packages/tiptap-extension-code-block-shiki</code> for a example.</p><h2 style="margin: 5px 0; font-size: 1.250em; font-weight: bold; margin-top: 0.5em"><b>0x02 Brief view of Tiptap</b></h2><blockquote style="
            overflow: hidden;
            padding: 10px 20px;
            border-left: 4px;
            border-style: solid;
            border-color: #70707099;
            margin: 10px 0;
            background-color: #afafaf33
        "><p>Tiptap is a <b>headless wrapper</b> around <b>ProseMirror </b>â€“ a toolkit for building rich text WYSIWYG editors, which is already in use at many well-known companies such as New York Times, The Guardian or Atlassian.</p></blockquote><p>For developer, <code class="inline-code">Tiptap</code> is a higher level <code class="inline-code">ProseMirror</code> encapsulation.</p><p>Tiptap provides:</p><ul class="list-paddingleft-1" style="padding-left: 1.25em; list-style-type: decimal"><li><p>Tiptap is <b>vanilla based</b>, is designed to be framework agnostic (React, Vue, Angular, Svelte...)</p></li><li><p>Combined a series of complex ProseMirror modules into a clear-path extension development suite. <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://tiptap.dev/docs/editor/extensions/custom-extensions"><u>Custom extension Guide | Tiptap Docs</u></a>.<br>You can easily migrate plugins from ProseMirror.</p></li><li><p>Rich production-ready extension. <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://tiptap.dev/docs/editor/extensions/overview"><u>Extensions | Tiptap Docs</u></a></p></li><li><p>Active and strong community. <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://github.com/ueberdosis/awesome-tiptap"><u>ueberdosis/awesome-tiptap: âš¡</u></a></p></li></ul><h2 style="margin: 5px 0; font-size: 1.250em; font-weight: bold; margin-top: 0.5em"><b>0x03 Get started with Tiptap</b></h2><h3 style="margin: 5px 0; font-size: 1.125em; font-weight: bold; margin-top: 0.3em"><b>0x03-00 How ProseMirror describe an editable content?</b></h3><p>ProseMirror use <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://prosemirror.net/docs/guide/#schema"><u>schema</u></a> to describe the content structure (DOM tree):</p><ul class="list-paddingleft-1" style="padding-left: 1.25em; list-style-type: disc"><li><p>Nodes are like blocks of content, for example paragraphs, headings, code blocks, blockquotes and many more</p></li><li><p>Marks can be applied to specific parts of a node. Thatâ€™s the case for <b>bold</b>, <em>italic </em>or <s>striked </s>text. <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://github.com/aolyang/tiptap-contentful"><u>Link</u></a> are marks, too.</p></li></ul><pre class="code-block" theme="vitesse-dark"><code class="language-javascript">const markSchema = new Schema({
    nodes: {
        // doc is the default top root node
        // "content" is a expression, "block+" contains at least one "block"
        // block group in this schema: paragraph, heading
        doc: { content: "block+" },

        // "text" node is a basic support for text content
        text: { inline: true },

        // define a paragraph node, divide into "block" group,
        // "text*" accepts 0 or more "text node"
        // "*" always fallow a node type
        // marks: "_", "_" acts as a wildcard
        paragraph: { group: "block", content: "text*", marks: "_" },
        // marks: "" empty string means no marks allowed
        heading: { group: "block", content: "text*", marks: "" }
    },
    marks: {
        // just tag, no big deal
        strong: {},
        em: {}
    }
})</code></pre><p>this schema can decribe a DOM with markup is represented as a tree, like this:</p><blockquote style="
            overflow: hidden;
            padding: 10px 20px;
            border-left: 4px;
            border-style: solid;
            border-color: #70707099;
            margin: 10px 0;
            background-color: #afafaf33
        "><p>Whereas in ProseMirror, the inline content is modeled as a flat sequence, with the markup attached as metadata to the nodes</p></blockquote><table style="min-width: 315px"><colgroup><col style="width: 290px"><col style="min-width: 25px"></colgroup><tbody><tr><td style="border: 1px solid #70707099" colspan="1" rowspan="1" colwidth="290"><pre class="code-block" theme="vitesse-dark"><code class="language-javascript">&lt;p&gt;
    This is
    &lt;strong&gt;
        strong text with
        &lt;em&gt;emphasis&lt;/em&gt;
    &lt;/strong&gt;
&lt;/p&gt;</code></pre></td><td style="border: 1px solid #70707099" colspan="1" rowspan="1"><p></p><img style="
            display: block;
            margin: 0 auto;
            max-width: 100%;
            max-height: 1000px;
            height: auto;
        " src="./doc-imgs/example-schema-1.png"></td></tr></tbody></table><h3 style="margin: 5px 0; font-size: 1.125em; font-weight: bold; margin-top: 0.3em"><b>0x03-01 Schema in Tiptap</b></h3><p><a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://tiptap.dev/docs/editor/core-concepts/schema"><u>Schema in tiptap</u></a> is the samething. You can easily describe a Node/Mark use Tiptap extension api with good TypeScript code Intelligence:</p><pre class="code-block" theme="vitesse-dark"><code class="language-javascript">import { Node, Mark } from '@tiptap/core'

const paragraph = Node.create({
    group: "block",
    content: "text*",
    marks: "_"
})
const strong = Mark.create({
    content: "text*",
    inline: true,
    // in ProseMirror
    // parseDOM: [{ tag: "strong" }]
    // tag &lt;strong/&gt; &lt;b/&gt; will been matched in this extension
    parseHTML: () =&gt; [{ tag: "strong" }, { tag: "b" }],
    // all matched HTML render to tag &lt;b/&gt;
    // like UI framework's render function:
    // first paramenter is tag, second is attributes, third is children
    // 0 is a children placeholder
    renderHTML() =&gt; ["b", {} , 0]
})</code></pre><p>Each extension (Node/Mark) describe them self, <b>high cohesion, low coupling</b>.</p><p>Tiptap will automatically organize extensions and generate a ProseMirror schema</p><pre class="code-block" theme="vitesse-dark"><code class="language-javascript">import { Editor } from "@tiptap/core"
import Document from "@tiptap/extension-document"
import Text from "@tiptap/extension-text"
import Bold from "@tiptap/extension-bold"
import Heading from "@tiptap/extension-heading"

const editor = new Editor({
    extensions: [
        Document, // doc
        Text, // text node
        Bold, // strong
        Heading // h1, h2, h3...
    ]
})</code></pre><h3 style="margin: 5px 0; font-size: 1.125em; font-weight: bold; margin-top: 0.3em"><b>0x03-02 Full view of tiptap extension, "How" questions</b></h3><p><b>Extension </b>is a base helper class to help you create <b>commands</b> , <b>keymap</b> etc...</p><p><b>Mark </b>is a subset of Node, Mark <b>only style or annotate text</b>, they can be a applied to any part of node, but can not change any structure of document.</p><p><b>Node </b>can be <b>block</b> or <b>inline</b> element. node can <b>render extra element</b> (like code block toolbars).</p><p>In the following, I will simply use <b>extension</b> to replace <b>node/mark/extension</b></p><h4 style="margin: 5px 0; font-size: 1.000em; font-weight: bold; margin-top: 0.3em"><span style="font-size: 18px"><b>1. How extension render a content?</b></span></h4><pre class="code-block" theme="vitesse-dark"><code class="language-javascript">const Node = Node.create({
    // 1. simple, just text
    renderText: () =&gt; "text content"
    // 2. describe the dom
    renderHTML: () =&gt; ["h1", {}, 0] // &lt;h1&gt;{children}&lt;/h1&gt;
    //    more complex one
    //    &lt;h1 data-id="my-block" class="foo"&gt;{children}&lt;/h1&gt;
    renderHTML: () =&gt; ["h1[data-id='my-block']", { class: "foo" }, 0]
    // 3. Node-View, advanced, handle change and DOM by your self
    addNodeView: () =&gt; {
        const pre = document.createElement("pre")
        const code = document.createElement("code")
        const toolbar = ReactDOM.createRoot(pre, &lt;ToolbarComponent /&gt;)
        return {
            // Node-View root dom node, will mount to editor doc
            dom: pre,
            // Content node, where the editable area
            // code element content change handled by ProseMirror
            contentDOM: code
        }
    }
})</code></pre><p><code class="inline-code">contentDOM</code> is important, if you want fully control your sub content, for example, mount a third party code editor (CodeMirror), just leave contentDOM null. <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://prosemirror.net/examples/codemirror/"><u>ProseMirror official example</u></a></p><pre class="code-block" theme="vitesse-dark"><code class="language-javascript">const Node = Node.create({
    addNodeView: () =&gt; {
        // CodeMirror will handle content change
	    const cm = new CodeMirror({
            doc: this.node.textContent,
            extensions: [
        	    CodeMirror.updateListener
                    .of(update =&gt; this.forwardUpdate(update))
            ]
	    })
        return {
            dom: cm.dom
        }
    }
})</code></pre><h4 style="margin: 5px 0; font-size: 1.000em; font-weight: bold; margin-top: 0.3em"><span style="font-size: 18px"><b>2. How exntension get "params" before render?</b></span></h4><p>Editor content accept <b>HTML string</b> and <b>JSON content </b>(like VDOM, describe node &amp; marks)</p><blockquote style="
            overflow: hidden;
            padding: 10px 20px;
            border-left: 4px;
            border-style: solid;
            border-color: #70707099;
            margin: 10px 0;
            background-color: #afafaf33
        "><p>The <code class="inline-code">parseFromString()</code> method of the <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://developer.mozilla.org/en-US/docs/Web/API/DOMParser"><u>DOMParser</u></a> interface parses a string containing either HTML or XML, returning an <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLDocument"><u>HTMLDocument</u></a> or an <a target="_blank" rel="noopener noreferrer nofollow" style="
            text-decoration: underline;
            color: #0096dc;
            cursor: pointer
        " href="https://developer.mozilla.org/en-US/docs/Web/API/XMLDocument"><u>XMLDocument</u></a>.</p></blockquote><pre class="code-block" theme="vitesse-dark"><code class="language-javascript">// native browser support
const parser = new window.DOMParser()
const document = parser.parseFromString(HTMLContent, "text/html")

// prosemirror-model provide methods to deserialize a node/mark from its JSON representation
const node = schema.nodeFromJSON(content)
// ...</code></pre><h4 style="margin: 5px 0; font-size: 1.000em; font-weight: bold; margin-top: 0.3em"><span style="font-size: 18px"><b>3. How extension render DOM relay on serialized "params"?</b></span></h4><h4 style="margin: 5px 0; font-size: 1.000em; font-weight: bold; margin-top: 0.3em"><span style="font-size: 18px"><b>4. How extension add commands?</b></span></h4><h4 style="margin: 5px 0; font-size: 1.000em; font-weight: bold; margin-top: 0.3em"><span style="font-size: 18px"><b>5. What is Transaction? How transaction update content?</b></span></h4><h4 style="margin: 5px 0; font-size: 1.000em; font-weight: bold; margin-top: 0.3em"><span style="font-size: 18px"><b>6. How to get node position? Or get node from pos?</b></span></h4><h2 style="margin: 5px 0; font-size: 1.250em; font-weight: bold; margin-top: 0.5em"><b>0x04 Let's build a CodeBlock extension as an example, and get figure out how it works.</b></h2><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>